(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{8370:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reading",function(){return t(80)}])},2798:function(e,a,t){"use strict";t.d(a,{y:function(){return r}}),t(7294);let s=t(3454).env.NEXT_PUBLIC_API_URL||"http://localhost:8011/api";class i{async request(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(s).concat(e),i={headers:{"Content-Type":"application/json"},...a};try{let e=await fetch(t,i);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){throw console.error("API request failed:",e),e}}async healthCheck(){return this.request("/health")}async createReading(e){return this.request("/reading",{method:"POST",body:JSON.stringify(e)})}async getSpreads(){let e=await this.request("/spreads");return{success:e.success,data:e.spreads}}async getSpreadDetail(e){return this.request("/spreads/".concat(e))}async getCards(e){let a=e?"?search=".concat(encodeURIComponent(e)):"",t=await this.request("/cards".concat(a));return{success:t.success,data:t.cards}}async getReadingHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new URLSearchParams;e.limit&&a.append("limit",e.limit.toString()),e.offset&&a.append("offset",e.offset.toString());let t=a.toString(),s=await this.request("/history".concat(t?"?".concat(t):""));return{success:s.success,data:{readings:s.readings,total:s.total,limit:s.limit,offset:s.offset}}}async getStatistics(){let e=await this.request("/statistics");return{success:e.success,data:e.statistics}}async recommendSpread(e){return this.request("/recommend-spread",{method:"POST",body:JSON.stringify({question:e})})}}let r=new i},80:function(e,a,t){"use strict";t.r(a);var s=t(5893),i=t(7294),r=t(9008),n=t.n(r),l=t(1664),c=t.n(l),d=t(3495),o=t(1526),m=t(3219),x=t(5162),u=t(9482),h=t(3742),p=t(3058),y=t(9037),j=t(713),g=t(2798);let b=e=>{let a={single:{duration:"约15秒",mysticalText:["\uD83D\uDD2E 单张神谕正在显现...","✨ 宇宙的智慧即将为您揭晓","\uD83C\uDF1F 命运之轮缓缓转动，答案即将浮现"]},three_card:{duration:"约45秒",mysticalText:["\uD83C\uDF19 过去、现在、未来的脉络正在交织...","✨ 时间之河的三重奥秘即将显现","\uD83D\uDD2E 三重神谕正在汇聚时空的能量"]},love_spread:{duration:"约1分钟",mysticalText:["\uD83D\uDC95 爱神维纳斯正在为您解读情感密码...","\uD83C\uDF39 五重心灵连接正在建立神秘链接","✨ 情感的星辰正在为您重新排列"]},career_spread:{duration:"约1分钟",mysticalText:["⚡ 事业之神墨丘利正在为您指引方向...","\uD83C\uDFDB️ 六重智慧之门正在为您开启","✨ 成功的星座正在为您重新连线"]},decision_spread:{duration:"约1分钟",mysticalText:["⚖️ 智慧女神雅典娜正在为您权衡选择...","\uD83D\uDD2E 七重决策之光正在照亮前路","✨ 命运的天平正在为您寻找平衡"]},celtic_cross:{duration:"约2分钟",mysticalText:["\uD83C\uDF1F 古老的凯尔特智慧正在苏醒...","\uD83D\uDD2E 十重神圣几何正在构建宇宙真理","✨ 最深层的奥秘即将为您完全展开"]}};return a[e]||a.single},f=e=>{let{question:a,setQuestion:t,onSubmit:i}=e;return(0,s.jsx)(d.E.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"container-narrow",children:(0,s.jsxs)("div",{className:"reading-card text-center",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(d.E.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:"w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center shadow-2xl shadow-purple-500/30",children:(0,s.jsx)(x.Z,{className:"w-10 h-10 text-amber-300"})})}),(0,s.jsx)("h2",{className:"text-responsive-lg font-mystical font-bold mb-6 text-gradient",children:"请输入您的问题"}),(0,s.jsx)("div",{className:"mystical-divider max-w-24 mx-auto mb-8"}),(0,s.jsx)("p",{className:"text-gray-300 mb-8 leading-relaxed max-w-2xl mx-auto",children:"静下心来，想一想您最想了解的问题。可以是关于爱情、事业、健康或人生方向的任何问题。 问题越具体，占卜结果越准确。"}),(0,s.jsx)("textarea",{value:a,onChange:e=>t(e.target.value),className:"mystical-input h-32 resize-none mb-8 text-lg",placeholder:"例如：我该如何提升我的事业运势？"}),(0,s.jsxs)(d.E.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:i,disabled:!a.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 mx-auto",children:[(0,s.jsx)(u.Z,{className:"w-5 h-5"}),"下一步：选择牌阵"]})]})})},N=e=>{let{spreads:a,selectedSpread:t,onSelect:i}=e;return(0,s.jsxs)(d.E.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"container-custom",children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h2",{className:"text-responsive-lg font-mystical font-bold mb-6 text-gradient",children:"选择占卜牌阵"}),(0,s.jsx)("div",{className:"mystical-divider max-w-24 mx-auto mb-6"}),(0,s.jsx)("p",{className:"text-gray-300 max-w-3xl mx-auto",children:"每种牌阵都有其独特的能量和解读方式，请选择最适合您问题的牌阵"})]}),(0,s.jsx)("div",{className:"grid-responsive",children:a.map((e,a)=>(0,s.jsx)(d.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*a},whileHover:{y:-8},onClick:()=>i(e.id),className:"spread-card cursor-pointer transition-all ".concat(t===e.id?"ring-2 ring-amber-400 shadow-2xl shadow-amber-500/30":""),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-xl font-mystical font-bold mb-4 text-white",children:e.name}),(0,s.jsx)("div",{className:"mystical-divider mb-4"}),(0,s.jsx)("p",{className:"text-gray-300 mb-6 leading-relaxed text-sm",children:e.description}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-purple-300",children:"牌数:"}),(0,s.jsxs)("span",{className:"font-semibold text-amber-300",children:[e.card_count," 张"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-purple-300",children:"难度:"}),(0,s.jsx)("span",{className:"font-semibold text-white",children:e.difficulty})]}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-3",children:e.usage})]}),t===e.id&&(0,s.jsxs)(d.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"mt-4 flex items-center justify-center gap-2 text-amber-300",children:[(0,s.jsx)(h.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm font-semibold",children:"已选择"})]})]})},e.id))}),t&&(0,s.jsx)(d.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mt-12",children:(0,s.jsxs)(d.E.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>{},className:"btn-primary flex items-center gap-3 mx-auto",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5"}),"继续抽牌"]})})]})},v=e=>{let{selectedSpread:a,selectedSpreadId:t,isLoading:i,isDrawing:r,drawnCards:n,currentMysticalText:l,onStartReading:c}=e;return(0,s.jsx)(d.E.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"container-narrow",children:(0,s.jsxs)("div",{className:"reading-card text-center",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(d.E.div,{animate:{rotate:i?360:0,scale:i?[1,1.1,1]:1},transition:{rotate:{duration:2,repeat:i?1/0:0,ease:"linear"},scale:{duration:1,repeat:i?1/0:0}},className:"w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center shadow-2xl shadow-purple-500/30",children:(0,s.jsx)(p.Z,{className:"w-12 h-12 text-amber-300"})})}),(0,s.jsx)("h2",{className:"text-responsive-lg font-mystical font-bold mb-6 text-gradient",children:r?"正在抽取塔罗牌...":"准备抽取塔罗牌"}),(0,s.jsx)("div",{className:"mystical-divider max-w-24 mx-auto mb-8"}),a&&(0,s.jsxs)("div",{className:"mb-8 p-6 bg-purple-900/30 rounded-xl border border-purple-500/30",children:[(0,s.jsxs)("p",{className:"text-gray-300 mb-2",children:["您选择的牌阵：",(0,s.jsx)("span",{className:"text-amber-300 font-semibold",children:a.name})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["将为您抽取 ",a.card_count," 张神谕之牌"]})]}),r&&n.length>0&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"flex justify-center gap-4 flex-wrap",children:n.map((e,a)=>(0,s.jsx)(d.E.div,{initial:{opacity:0,scale:0,rotateY:180},animate:{opacity:1,scale:1,rotateY:0},transition:{delay:.5*a,duration:.8},className:"tarot-card",children:(0,s.jsx)("div",{className:"tarot-card-back",children:(0,s.jsx)(x.Z,{className:"text-amber-300"})})},a))})}),r||i?(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsxs)("div",{className:"mb-6 p-4 bg-purple-900/40 rounded-xl border border-purple-400/30 backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"text-amber-300 font-mystical text-lg mb-2",children:["⏳ 预计占卜时间：",b(t).duration]}),(0,s.jsx)("div",{className:"text-gray-400 text-sm",children:"占卜复杂度越高，所需时间越长，请耐心等待"})]}),(0,s.jsx)(d.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.8},className:"text-gray-300 leading-relaxed font-mystical text-lg",children:l},l),(0,s.jsx)("div",{className:"flex justify-center gap-2 mt-6",children:[0,1,2].map(e=>(0,s.jsx)(d.E.div,{animate:{scale:[1,1.5,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:.5*e},className:"w-2 h-2 bg-amber-400 rounded-full"},e))}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 text-purple-300 text-sm",children:[(0,s.jsx)(d.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-purple-400 border-t-transparent rounded-full"}),"神谕解读中..."]})})]}):(0,s.jsx)("p",{className:"text-gray-300 mb-8 leading-relaxed",children:"静心凝神，专注于您的问题，然后点击下方按钮开始抽牌"}),!r&&(0,s.jsx)(d.E.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:c,disabled:i,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 mx-auto text-lg px-8 py-4",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"loading-spinner"}),"占卜中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Z,{className:"w-6 h-6"}),"开始抽牌"]})})]})})},w=e=>{let{result:a,onNewReading:t}=e;return(0,s.jsxs)(d.E.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"container-custom",children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h2",{className:"text-responsive-lg font-mystical font-bold mb-6 text-gradient",children:"您的塔罗解读"}),(0,s.jsx)("div",{className:"mystical-divider max-w-24 mx-auto mb-6"}),(0,s.jsx)("p",{className:"text-amber-300 font-semibold text-lg",children:a.reading_summary})]}),a.drawn_cards&&a.drawn_cards.length>0&&(0,s.jsxs)("div",{className:"reading-card mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-mystical font-bold mb-6 text-center text-white",children:"抽到的牌"}),(0,s.jsx)("div",{className:"flex justify-center gap-6 flex-wrap",children:a.drawn_cards.map((e,a)=>(0,s.jsxs)(d.E.div,{initial:{opacity:0,rotateY:180},animate:{opacity:1,rotateY:0},transition:{delay:.3*a,duration:.8},className:"drawn-card text-center p-4",children:[(0,s.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDFB4"}),(0,s.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"reversed"===e.orientation?"逆位":"正位"})]},a))})]}),(0,s.jsxs)("div",{className:"reading-card mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-mystical font-bold mb-6 text-white",children:"占卜解读"}),(0,s.jsx)("div",{className:"prose prose-invert max-w-none",children:(0,s.jsx)("p",{className:"text-gray-300 leading-relaxed whitespace-pre-line",children:a.combined_reading})})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,s.jsxs)(d.E.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:t,className:"btn-primary flex items-center gap-3",children:[(0,s.jsx)(j.Z,{className:"w-5 h-5"}),"重新占卜"]}),(0,s.jsx)(c(),{href:"/",children:(0,s.jsxs)(d.E.button,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},className:"btn-secondary flex items-center gap-3",children:[(0,s.jsx)(m.Z,{className:"w-5 h-5"}),"返回首页"]})})]})]})};a.default=()=>{let[e,a]=(0,i.useState)("question"),[t,r]=(0,i.useState)(""),[l,x]=(0,i.useState)(""),[u,h]=(0,i.useState)(!1),[p,y]=(0,i.useState)(null),[j,_]=(0,i.useState)([]),[D,E]=(0,i.useState)(null),[S,T]=(0,i.useState)([]),[C,q]=(0,i.useState)(!1),[k,P]=(0,i.useState)(""),[I,F]=(0,i.useState)(0);(0,i.useEffect)(()=>{(async()=>{try{let e=await g.y.getSpreads();_(e.data||[])}catch(e){_([{id:"single",name:"单张牌占卜",description:"简单快速的日常指引",card_count:1,difficulty:"简单",usage:"日常问题"},{id:"three_card",name:"三张牌占卜",description:"过去现在未来的时间线分析",card_count:3,difficulty:"中等",usage:"发展趋势"},{id:"celtic_cross",name:"凯尔特十字",description:"复杂问题的全面解析",card_count:10,difficulty:"高级",usage:"深度分析"}])}})()},[]),(0,i.useEffect)(()=>{if(C||u){let e=b(l||"single").mysticalText;P(e[0]),F(0);let a=setInterval(()=>{F(a=>{let t=(a+1)%e.length;return P(e[t]),t})},4e3);return()=>clearInterval(a)}},[C,u,l]);let Z=async()=>{h(!0),q(!0),E(null);try{let e=j.find(e=>e.id===l),s=(null==e?void 0:e.card_count)||1,i=[];for(let e=0;e<s;e++)i.push({name:"Card ".concat(e+1),reversed:Math.random()>.7,position:e+1,orientation:Math.random()>.7?"reversed":"upright"});T(i),await new Promise(e=>setTimeout(e,2e3)),console.log("发送API请求...",{question:t,spread_type:l});let r=new AbortController,n=setTimeout(()=>r.abort(),3e4);try{let e=await g.y.createReading({question:t,spread_type:l,save_result:!0});if(clearTimeout(n),console.log("API响应:",e),e&&e.success)console.log("设置占卜结果，跳转到结果页..."),y(e),a("result");else throw console.error("API返回错误:",(null==e?void 0:e.error)||"未知错误"),Error((null==e?void 0:e.error)||"占卜过程中发生错误")}catch(e){throw clearTimeout(n),e}}catch(s){var e;console.error("Reading error:",s),E(s instanceof Error?s.message:"占卜失败，请重试"),y({success:!0,question:t,question_category:"general",spread_type:l,spread_name:(null===(e=j.find(e=>e.id===l))||void 0===e?void 0:e.name)||"占卜",drawn_cards:S,individual_readings:[],combined_reading:"\uD83D\uDD2E 由于AI占卜师暂时无法连接，为您提供了基础的塔罗指引。请静心感受这些牌带给您的直觉启发。",reading_summary:"相信直觉，静心感受牌的指引。",timestamp:new Date().toISOString()}),a("result")}finally{h(!1),q(!1)}},H=()=>["question","spread","cards","result"].indexOf(e)+1;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"塔罗占卜进行中 - 神秘塔罗牌占卜师"}),(0,s.jsx)("meta",{name:"description",content:"正在进行塔罗牌占卜，探索您内心的答案"})]}),(0,s.jsx)("main",{className:"min-h-screen py-8",children:(0,s.jsxs)("div",{className:"container-custom",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,s.jsx)(c(),{href:"/",children:(0,s.jsxs)(d.E.button,{whileHover:{scale:1.05,x:-5},className:"btn-secondary flex items-center gap-2",children:[(0,s.jsx)(m.Z,{size:20}),"返回首页"]})}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:[1,2,3,4].map(e=>(0,s.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-300 ".concat(e<=H()?"bg-gradient-to-r from-amber-400 to-amber-600 shadow-lg shadow-amber-500/50":"bg-gray-600")},e))})]}),D&&(0,s.jsx)(d.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 p-4 bg-red-900/50 border border-red-500/50 rounded-xl text-red-200",children:D}),(0,s.jsxs)(o.M,{mode:"wait",children:["question"===e&&(0,s.jsx)(f,{question:t,setQuestion:r,onSubmit:()=>{t.trim()&&a("spread")}}),"spread"===e&&(0,s.jsx)(N,{spreads:j,selectedSpread:l,onSelect:e=>{x(e),a("cards")}}),"cards"===e&&(0,s.jsx)(v,{selectedSpread:j.find(e=>e.id===l),selectedSpreadId:l,isLoading:u,isDrawing:C,drawnCards:S,currentMysticalText:k,onStartReading:Z}),"result"===e&&p&&(0,s.jsx)(w,{result:p,onNewReading:()=>{a("question"),r(""),x(""),y(null),T([]),E(null)}})]})]})})]})}}},function(e){e.O(0,[965,297,774,888,179],function(){return e(e.s=8370)}),_N_E=e.O()}]);